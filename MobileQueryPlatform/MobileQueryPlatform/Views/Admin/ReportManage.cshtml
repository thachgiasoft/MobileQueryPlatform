<script type="text/template" id="tempReportList">
    <%for(var i=0;i<data.length;i++){ %>
        <tr>
            <td><%=data[i].ReportName%></td>
            <td><%=data[i].DBName%></td>
            <td><%=data[i].Enabled==true?"是":"否"%></td>
            <td><%=data[i].Remark%></td>
            <td>
                <a class="btn btn-default" data-action="del" data-id="<%=i%>"><span class="glyphicon glyphicon-trash"></span></a>
                <a class="btn btn-default" data-action="edit" data-id="<%=i%>"><span class="glyphicon glyphicon-pencil"></span></a>
                <a class="btn btn-default" data-action="enabled" data-id="<%=i%>"><span class="glyphicon glyphicon-eye-open"></span></a>
            </td>
        </tr>
    <%}%>
</script>

<script id="tempReportView" type="text/template">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">报表编辑</h4>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <label for="userCode">报表名称</label>
                        <input id="userCode" type="text" class="form-control" name="UserCode" placeholder="输入报表名称" autofocus="autofocus" required="required" />
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label for="userName">数据源</label>
                                <br />
                                <div class="btn-group">
                                    <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">
                                        选择数据源 <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu" role="menu">
                                        <li><a>QueryMobile</a></li>
                                        <li><a>Another action</a></li>
                                        <li><a>Something else here</a></li>
                                        <li class="divider"></li>
                                        <li><a>Separated link</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label>页合计</label>
                                <br />
                                <div class="btn-group" data-toggle="buttons">
                                    <label id="isAdmin_t" class="btn btn-info">
                                        <input name="IsAdmin" type="radio" value="true">&nbsp;&nbsp;是&nbsp;&nbsp;
                                    </label>
                                    <label id="isAdmin_f" class="btn btn-info active">
                                        <input name="IsAdmin" type="radio" value="false">&nbsp;&nbsp;否&nbsp;&nbsp;
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label>总合计</label>
                                <br />
                                <div class="btn-group" data-toggle="buttons">
                                    <label id="isAdmin_t" class="btn btn-info">
                                        <input name="IsAdmin" type="radio" value="true">&nbsp;&nbsp;是&nbsp;&nbsp;
                                    </label>
                                    <label id="isAdmin_f" class="btn btn-info active">
                                        <input name="IsAdmin" type="radio" value="false">&nbsp;&nbsp;否&nbsp;&nbsp;
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label>分页</label>
                                <br />
                                <div class="btn-group" data-toggle="buttons">
                                    <label id="isAdmin_t" class="btn btn-info">
                                        <input name="IsAdmin" type="radio" value="true">&nbsp;&nbsp;是&nbsp;&nbsp;
                                    </label>
                                    <label id="isAdmin_f" class="btn btn-info active">
                                        <input name="IsAdmin" type="radio" value="false">&nbsp;&nbsp;否&nbsp;&nbsp;
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label for="userName">每页显示条数</label>
                                <input id="userName" type="text" class="form-control" name="UserName" placeholder="输入条数" autofocus="autofocus" required="required" />
                            </div>
                        </div>
                    </div>
                    <hr />
                    <div class="form-group">
                        <label>参数</label>
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover  table-condensed">
                                <thead>
                                    <tr>
                                        <th>参数编码</th>
                                        <th>显示名称</th>
                                        <th>参数类型</th>
                                        <th>输入类型</th>
                                        <th>列表值</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>name</td>
                                        <td><input type="text" class="form-control" value="" placeholder="name" /></td>
                                        <td>
                                            <div class="btn-group">
                                                <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">
                                                    字符型 <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu" role="menu">
                                                    <li class="active"><a>字符型</a></li>
                                                    <li><a>日期型</a></li>
                                                    <li><a>数字型</a></li>
                                                </ul>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="btn-group">
                                                <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">
                                                    手动输入 <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu" role="menu">
                                                    <li class="active"><a>手动输入</a></li>
                                                    <li><a>列表选择</a></li>
                                                </ul>
                                            </div>
                                        </td>
                                        <td><input type="text" class="form-control" readonly placeholder="多个参数以分号隔开" /></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>字段</label>
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover  table-condensed">
                                <thead>
                                    <tr>
                                        <th>字段编码</th>
                                        <th>显示名称</th>
                                        <th>排序</th>
                                        <th>求和</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>name</td>
                                        <td><input type="text" class="form-control" value="" placeholder="name" /></td>
                                        <td>
                                            <input type="checkbox" value="">
                                        </td>
                                        <td>
                                            <input type="checkbox" value="">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="sqlCommand">SQL语句</label><a class="btn btn-sm btn-warning pull-right">刷新结构</a>
                        <textarea id="sqlCommand" class="form-control" rows="3">select * from tDatabase</textarea>

                    </div>
                    <div class="form-group">
                        <label>表头预览</label>
                        <div style="overflow-x:auto">
                            <table class="table table-striped table-bordered table-hover table-condensed">
                                <tbody>
                                    <tr>
                                        <td>column1</td>
                                        <td>column2</td>
                                        <td>column3</td>
                                        <td>column4</td>
                                        <td>column5</td>
                                        <td>column6</td>
                                        <td>column1</td>
                                        <td>column2</td>
                                        <td>column3</td>
                                        <td>column4</td>
                                        <td>column5</td>
                                        <td>column6</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <a class="btn btn-default" data-dismiss="modal">关闭</a>
                <a class="btn btn-primary" id="save">保存</a>
            </div>
        </div>
    </div>
</script>

<script type="text/javascript">
    if (window.ReportManage == undefined) {
        Tools.Namespace.register("window.ReportManage");
    }
    
    if (window.ReportManage.Toolbar == undefined) {
        window.ReportManage.Toolbar = Backbone.View.extend({
            events: {
                "click a": "clickBtn"
            },
            clickBtn: function (e) {
                switch ($(e.currentTarget).attr("data-action")) {
                    case "add":
                        reportView.show(null);
                        break;
                    case "refresh":
                        reportListView.refresh();
                        break;
                }
            }

        });
    }
   
    if (window.ReportManage.Report == undefined) {
        window.ReportManage.Report = Backbone.Model.extend({
            defaults: {
                "ID": null,
                "DBID": null,
                "DBName": "",
                "ReportName": "",
                "Enabled": true,
                "Remark": "",
                "Columns": null,
                "Params": null,
                "Command": null,
                "Result": null
            },
            idAttribute:"ID",
            urlRoot:"/api/Report"
        });
    }

    
    if (window.ReportManage.ReportList == undefined) {
        window.ReportManage.ReportList = Backbone.Collection.extend({
            model: window.ReportManage.Report,
            url: "/api/Report"
        });
    }
    
    if (window.ReportManage.ReportListView == undefined) {
        window.ReportManage.ReportListView = Backbone.View.extend({
            template: _.template($("#tempReportList").html()),
            render: function (data) {
                this.$el.html(this.template(data));
            },
            refresh: function () {
                reportList.fetch({
                    success: function (collection, response, options) {
                        
                        reportListView.render({ data: response });
                    },
                    error: function (e) {
                        alert(e.responseJSON.Message);
                    }
                });
            }
        });
    }

    if (window.ReportManage.ReportView == undefined) {
        window.ReportManage.ReportView = Backbone.View.extend({
            template: _.template($("#tempReportView").html()),
            render: function (data) {
                this.$el.html(this.template(data));
            },
            show: function (data) {
                this.render(null);
                this.$el.modal({
                    show: true,
                    keyboard: false,
                    backdrop: false
                });
            }
        });
    }
</script>

<script type="text/javascript">
    var toolbar;
    var reportList;
    var reportListView;
    var reportView;
    $(function () {
        
        toolbar = new window.ReportManage.Toolbar({
            el: "#toolbar"
        });
        reportList = new window.ReportManage.ReportList();
        reportListView = new window.ReportManage.ReportListView({
            el: "#reportList"
        });
        reportView = new window.ReportManage.ReportView({
            el: "#reportView"
        });
        reportListView.refresh();
    })
</script>

<div class="table-responsive">
    <table class="table table-bordered table-hover">
        <thead>
            <tr>
                <th>报表名</th>
                <th>数据源</th>
                <th>可用</th>
                <th>说明</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody id="reportList"></tbody>
    </table> 
</div>

<div class="modal fade" aria-hidden="true" id="reportView"/>

<div class="navbar navbar-fixed-bottom">
    <div class="navbar-header">
        <div class="btn-group btn-group-lg btn-group-justified" id="toolbar">
            <a class="btn btn-default" data-action="refresh"><span class="glyphicon glyphicon-refresh"></span>刷新</a>
            <a class="btn btn-default" data-action="add"><span class="glyphicon glyphicon-plus"></span>新建</a>
        </div>
    </div>
</div> 